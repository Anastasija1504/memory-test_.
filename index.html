<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>–¢–µ—Å—Ç –Ω–∞ –ø–∞–º'—è—Ç—å ‚Äî –∑–≤–æ—Ä–æ—Ç–Ω—ñ —Ü–∏—Ñ—Ä–∏</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Segoe UI", Arial, sans-serif;
      background: radial-gradient(circle at top, #00c6ff 0, #16213e 40%, #0b0b1f 100%);
      color: #f5f6fa;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .card {
      background: rgba(10, 10, 25, 0.9);
      border-radius: 18px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
      padding: 24px 26px 30px;
      max-width: 420px;
      width: 100%;
      border: 1px solid rgba(0, 198, 255, 0.4);
      backdrop-filter: blur(10px);
    }

    h1 {
      margin: 0 0 8px;
      font-size: 1.6rem;
      text-align: center;
      color: #00c6ff;
    }

    .subtitle {
      font-size: 0.9rem;
      text-align: center;
      color: #a4b0be;
      margin-bottom: 18px;
    }

    .name-row {
      display: flex;
      gap: 8px;
      margin-bottom: 14px;
      align-items: center;
    }

    label {
      font-size: 0.9rem;
    }

    input[type="text"] {
      flex: 1;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid #3d3d5c;
      background: rgba(15, 15, 35, 0.9);
      color: #f5f6fa;
      outline: none;
      font-size: 0.95rem;
    }

    input[type="text"]::placeholder {
      color: #747d8c;
    }

    input[type="text"]:focus {
      border-color: #00c6ff;
      box-shadow: 0 0 0 1px rgba(0, 198, 255, 0.4);
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 9px 14px;
      background: linear-gradient(135deg, #00c6ff, #4d9fff);
      color: #0b1020;
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.1s ease, filter 0.1s ease;
      white-space: nowrap;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 14px rgba(0, 198, 255, 0.3);
      filter: brightness(1.05);
    }

    button:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: none;
      filter: brightness(0.95);
    }

    button.secondary {
      background: transparent;
      border: 1px solid #57606f;
      color: #f5f6fa;
      box-shadow: none;
    }

    .top-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      gap: 8px;
    }

    .progress {
      font-size: 0.85rem;
      color: #a4b0be;
    }

    .display {
      margin: 16px auto 8px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.6rem;
      letter-spacing: 0.2em;
      font-weight: 600;
      color: #ffffff;
    }

    .hint {
      font-size: 0.85rem;
      color: #a4b0be;
      text-align: center;
      min-height: 18px;
    }

    .answer-row {
      margin-top: 10px;
      display: flex;
      gap: 8px;
    }

    .answer-row input[type="text"] {
      text-align: center;
      letter-spacing: 0.3em;
      font-size: 1.1rem;
    }

    .feedback {
      margin-top: 8px;
      font-size: 0.9rem;
      text-align: center;
      min-height: 20px;
    }

    .feedback.ok {
      color: #2ed573;
    }

    .feedback.bad {
      color: #ff6b81;
    }

    .result {
      margin-top: 12px;
      font-size: 0.95rem;
      text-align: center;
      color: #f1f2f6;
      min-height: 22px;
    }

    .small-note {
      margin-top: 10px;
      font-size: 0.75rem;
      color: #57606f;
      text-align: center;
    }

    @media (max-width: 480px) {
      .card {
        margin: 12px;
        padding: 18px 16px 22px;
      }
      h1 {
        font-size: 1.4rem;
      }
      .display {
        font-size: 2.2rem;
      }
    }
  </style>
</head>

<body>
  <div class="card">
    <h1>–¢–µ—Å—Ç –Ω–∞ –ø–∞–º'—è—Ç—å</h1>
    <div class="subtitle">
      –ó–∞–ø–∞–º‚Äô—è—Ç–∞–π 3 —Ü–∏—Ñ—Ä–∏ —Ç–∞ –≤–≤–µ–¥–∏ —ó—Ö —É –∑–≤–æ—Ä–æ—Ç–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É.<br />
      5 —Ä—ñ–≤–Ω—ñ–≤ √ó 3 —Å–ø—Ä–æ–±–∏ = 15 –∑–∞–≤–¥–∞–Ω—å.
    </div>

    <div class="name-row">
      <label for="player-name">–Ü–º‚Äô—è:</label>
      <input type="text" id="player-name" placeholder="–í–≤–µ–¥—ñ—Ç—å —Å–≤–æ—î —ñ–º‚Äô—è" />
      <button id="start-btn">–ü–æ—á–∞—Ç–∏</button>
    </div>

    <div class="top-row">
      <div class="progress" id="progress">–†—ñ–≤–µ–Ω—å 1 —ñ–∑ 5 ‚Ä¢ –°–ø—Ä–æ–±–∞ 1 —ñ–∑ 3</div>
      <button id="restart-btn" class="secondary" style="display:none;">–°–ø–æ—á–∞—Ç–∫—É</button>
    </div>

    <div class="display" id="display"></div>
    <div class="hint" id="hint">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å ¬´–ü–æ—á–∞—Ç–∏¬ª, —â–æ–± —Ä–æ–∑–ø–æ—á–∞—Ç–∏ –≥—Ä—É.</div>

    <form id="answer-form">
      <div class="answer-row" id="answer-section" style="display:none;">
        <input
          type="text"
          id="answer-input"
          maxlength="3"
          autocomplete="off"
          placeholder="___"
        />
        <button type="submit">–ì–æ—Ç–æ–≤–æ</button>
      </div>
    </form>

    <div class="feedback" id="feedback"></div>
    <div class="result" id="result"></div>
    <div class="small-note">
      –ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –≥—Ä–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –Ω–∞–¥—Å–∏–ª–∞—î—Ç—å—Å—è –¥–æ Google –¢–∞–±–ª–∏—Ü—ñ.
    </div>
  </div>

  <script>
    // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≥—Ä–∏
    const LEVELS = 5;
    const TRIALS_PER_LEVEL = 3;
    const DIGITS_PER_TRIAL = 3;

    // –ï–ª–µ–º–µ–Ω—Ç–∏ DOM
    const playerNameInput = document.getElementById("player-name");
    const startBtn = document.getElementById("start-btn");
    const restartBtn = document.getElementById("restart-btn");
    const displayEl = document.getElementById("display");
    const hintEl = document.getElementById("hint");
    const progressEl = document.getElementById("progress");
    const answerSection = document.getElementById("answer-section");
    const answerInput = document.getElementById("answer-input");
    const answerForm = document.getElementById("answer-form");
    const feedbackEl = document.getElementById("feedback");
    const resultEl = document.getElementById("result");

    // –ó–º—ñ–Ω–Ω—ñ —Å—Ç–∞–Ω—É
    let currentLevel = 1;
    let currentTrial = 1;
    let currentSequence = [];
    let correctCount = 0;
    let gameActive = false;

    function resetGameState() {
      currentLevel = 1;
      currentTrial = 1;
      correctCount = 0;
      currentSequence = [];
      gameActive = false;
      feedbackEl.textContent = "";
      feedbackEl.className = "feedback";
      resultEl.textContent = "";
      displayEl.textContent = "";
      answerSection.style.display = "none";
      hintEl.textContent = "–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å ¬´–ü–æ—á–∞—Ç–∏¬ª, —â–æ–± —Ä–æ–∑–ø–æ—á–∞—Ç–∏ –≥—Ä—É.";
      updateProgressText();
    }

    function updateProgressText() {
      progressEl.textContent = `–†—ñ–≤–µ–Ω—å ${currentLevel} —ñ–∑ ${LEVELS} ‚Ä¢ –°–ø—Ä–æ–±–∞ ${currentTrial} —ñ–∑ ${TRIALS_PER_LEVEL}`;
    }

    function generateSequence() {
      currentSequence = [];
      for (let i = 0; i < DIGITS_PER_TRIAL; i++) {
        currentSequence.push(Math.floor(Math.random() * 10));
      }
    }

    function showSequence() {
      answerSection.style.display = "none";
      feedbackEl.textContent = "";
      feedbackEl.className = "feedback";
      answerInput.value = "";
      displayEl.textContent = "";
      hintEl.textContent = "–ó–∞–ø–∞–º‚Äô—è—Ç–∞–π—Ç–µ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å —Ü–∏—Ñ—Ä.";

      let index = 0;

      function showNext() {
        if (!gameActive) return;

        if (index < currentSequence.length) {
          displayEl.textContent = currentSequence[index];
          index++;
          setTimeout(() => {
            displayEl.textContent = "";
            setTimeout(showNext, 400); // –ø–∞—É–∑–∞ –º—ñ–∂ —Ü–∏—Ñ—Ä–∞–º–∏
          }, 700); // —á–∞—Å –ø–æ–∫–∞–∑—É —Ü–∏—Ñ—Ä–∏
        } else {
          setTimeout(() => {
            displayEl.textContent = "";
            showAnswerInput();
          }, 400);
        }
      }

      showNext();
    }

    function showAnswerInput() {
      hintEl.textContent = "–í–≤–µ–¥—ñ—Ç—å —Ü—ñ —Ü–∏—Ñ—Ä–∏ —É –∑–≤–æ—Ä–æ—Ç–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É (–±–µ–∑ –ø—Ä–æ–±—ñ–ª—ñ–≤).";
      answerSection.style.display = "flex";
      answerInput.focus();
    }

    function goToNextTrialOrLevel() {
      if (currentLevel === LEVELS && currentTrial === TRIALS_PER_LEVEL) {
        finishGame();
        return;
      }

      currentTrial++;
      if (currentTrial > TRIALS_PER_LEVEL) {
        currentTrial = 1;
        currentLevel++;
      }

      updateProgressText();
      setTimeout(startTrial, 900);
    }

    function startTrial() {
      if (!gameActive) return;
      updateProgressText();
      generateSequence();
      showSequence();
    }

    function startGame() {
      const name = playerNameInput.value.trim();
      if (!name) {
        alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å —Å–≤–æ—î —ñ–º‚Äô—è –ø–µ—Ä–µ–¥ –ø–æ—á–∞—Ç–∫–æ–º –≥—Ä–∏.");
        playerNameInput.focus();
        return;
      }

      resetGameState();
      gameActive = true;
      restartBtn.style.display = "inline-block";
      hintEl.textContent = "–ó–∞–ø–∞–º‚Äô—è—Ç–∞–π—Ç–µ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å —Ü–∏—Ñ—Ä.";
      startTrial();
    }

    function finishGame() {
      gameActive = false;
      answerSection.style.display = "none";
      hintEl.textContent = "–ì—Ä—É –∑–∞–≤–µ—Ä—à–µ–Ω–æ.";
      const total = LEVELS * TRIALS_PER_LEVEL;
      resultEl.textContent = `–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ${correctCount} —ñ–∑ ${total} –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π.`;
      sendResultToSheet(correctCount, total);
    }

    // –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –≤ Google Apps Script
    function sendResultToSheet(score, totalTrials) {
      const name = playerNameInput.value.trim() || "–ë–µ–∑ —ñ–º–µ–Ω—ñ";

      const payload = {
        name: name,
        score: score,
        totalTrials: totalTrials,
        timestamp: new Date().toISOString()
      };

      // üîµ –í–°–¢–ê–í –°–Æ–î–ò URL –¢–í–û–ì–û –í–ï–ë-–î–û–î–ê–¢–ö–ê (Apps Script)
      const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbw--aQMEHXlA7D_ZEWijf2Bip42dIQjJ3X8gvl9Cri4XdLE6jM7b74Ak0WhzWU870Z1pg/exec";

      fetch(WEB_APP_URL, {
        method: "POST",
        body: new URLSearchParams({
          data: JSON.stringify(payload)
        })
      }).catch((err) => {
        console.error("–ü–æ–º–∏–ª–∫–∞ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É:", err);
      });
    }

    // –û–±—Ä–æ–±–∫–∞ —Ñ–æ—Ä–º–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
    answerForm.addEventListener("submit", function (e) {
      e.preventDefault();
      if (!gameActive) return;

      const raw = answerInput.value.trim();
      if (raw.length !== DIGITS_PER_TRIAL || !/^\d+$/.test(raw)) {
        feedbackEl.textContent = `–í–≤–µ–¥—ñ—Ç—å —Ä—ñ–≤–Ω–æ ${DIGITS_PER_TRIAL} —Ü–∏—Ñ—Ä–∏ –±–µ–∑ –ø—Ä–æ–±—ñ–ª—ñ–≤.`;
        feedbackEl.className = "feedback bad";
        return;
      }

      const correctReversed = currentSequence.slice().reverse().join("");
      if (raw === correctReversed) {
        correctCount++;
        feedbackEl.textContent = "–ü—Ä–∞–≤–∏–ª—å–Ω–æ! ‚úÖ";
        feedbackEl.className = "feedback ok";
      } else {
        feedbackEl.textContent = `–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –ü—Ä–∞–≤–∏–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å: ${correctReversed}`;
        feedbackEl.className = "feedback bad";
      }

      goToNextTrialOrLevel();
    });

    startBtn.addEventListener("click", startGame);
    restartBtn.addEventListener("click", () => {
      resetGameState();
      gameActive = true;
      restartBtn.style.display = "inline-block";
      startTrial();
    });

    // –ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Å—Ç–∞–Ω
    resetGameState();
  </script>
</body>
</html>
